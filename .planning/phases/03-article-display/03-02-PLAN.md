---
phase: 03-article-display
plan: 02
type: execute
wave: 2
depends_on: [03-01]
files_modified:
  - internal/server/handlers.go
  - templates/partials/article-list.gohtml
  - static/styles.css
autonomous: true

must_haves:
  truths:
    - "User sees article cards with favicon, title, blog name, and relative time"
    - "Clicking article opens original URL in new browser tab"
    - "Articles display correctly in both Inbox and Archived views"
    - "All external links include rel=noopener noreferrer for security"
  artifacts:
    - path: "templates/partials/article-list.gohtml"
      provides: "Article card template with rich metadata"
      contains: "article-card"
    - path: "static/styles.css"
      provides: "Article card CSS with flexbox layout"
      contains: ".article-card"
    - path: "internal/server/handlers.go"
      provides: "Handlers using ListArticlesWithBlog"
      contains: "ListArticlesWithBlog"
  key_links:
    - from: "templates/partials/article-list.gohtml"
      to: "timeAgo function"
      via: "template call"
      pattern: "timeAgo .PublishedDate"
    - from: "templates/partials/article-list.gohtml"
      to: "faviconURL function"
      via: "template call"
      pattern: "faviconURL .BlogURL"
    - from: "internal/server/handlers.go"
      to: "storage.ListArticlesWithBlog"
      via: "method call"
      pattern: "s.db.ListArticlesWithBlog"
---

<objective>
Update article list template and CSS to display rich article cards with metadata.

Purpose: With the template functions and database infrastructure from Plan 01, this plan wires everything together to display beautiful article cards. Each card shows the blog's favicon, article title (clickable to original), blog name, and relative timestamp. The handlers switch from ListArticlesByReadStatus to ListArticlesWithBlog to get the blog metadata.

Output:
- Updated handlers using ListArticlesWithBlog for article data
- Article card template using timeAgo and faviconURL functions
- CSS for article card layout with favicon, content area, and metadata
</objective>

<execution_context>
@/Users/esteban.torres/.claude/get-shit-done/workflows/execute-plan.md
@/Users/esteban.torres/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-article-display/03-RESEARCH.md
@internal/server/handlers.go
@templates/partials/article-list.gohtml
@static/styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update handlers to use ListArticlesWithBlog</name>
  <files>internal/server/handlers.go</files>
  <action>
Modify internal/server/handlers.go to use the new ListArticlesWithBlog method:

1. In handleIndex function:
   - Change `var articles []model.Article` to `var articles []model.ArticleWithBlog`
   - Replace all calls to `s.db.ListArticlesByReadStatus(...)` with `s.db.ListArticlesWithBlog(...)`
   - The parameters (isRead bool, blogID *int64) remain the same

2. In handleArticleList function:
   - Change `var articles []model.Article` to `var articles []model.ArticleWithBlog`
   - Replace all calls to `s.db.ListArticlesByReadStatus(...)` with `s.db.ListArticlesWithBlog(...)`

Note: The template data map key "Articles" stays the same - templates will access the new BlogName and BlogURL fields.
  </action>
  <verify>
Run `go build ./...` to confirm compilation succeeds.
Run `go vet ./...` to check for issues.
  </verify>
  <done>
Both handleIndex and handleArticleList use ListArticlesWithBlog.
Articles slice type is model.ArticleWithBlog.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update article-list template with card layout</name>
  <files>templates/partials/article-list.gohtml</files>
  <action>
Replace content of templates/partials/article-list.gohtml with article card design:

```gohtml
{{define "article-list.gohtml"}}
{{/* ABOUTME: Renders article cards in the main content area with rich metadata.
     ABOUTME: Each card shows favicon, title (clickable), blog name, and relative time. */}}
<h1>{{if eq .CurrentFilter "read"}}Archived{{else}}Inbox{{end}}</h1>
{{range .Articles}}
<article class="article-card">
    <img class="article-favicon"
         src="{{faviconURL .BlogURL}}"
         alt=""
         width="32"
         height="32"
         loading="lazy"
         onerror="this.style.visibility='hidden'">
    <div class="article-content">
        <a href="{{.URL}}"
           target="_blank"
           rel="noopener noreferrer"
           class="article-title">
            {{.Title}}
        </a>
        <div class="article-meta">
            <span class="article-source">{{.BlogName}}</span>
            {{if .PublishedDate}}
            <span class="article-time">{{timeAgo .PublishedDate}}</span>
            {{end}}
        </div>
    </div>
</article>
{{else}}
<p class="empty-state">No articles to display. Add some blogs using the blogwatcher CLI to get started.</p>
{{end}}
{{end}}
```

Key elements:
- article-card class for each card (replaces .article)
- img with faviconURL, lazy loading, onerror fallback
- Article title wrapped in anchor with target="_blank" AND rel="noopener noreferrer"
- article-meta div with blog name and timeAgo relative time
- Empty state message preserved
  </action>
  <verify>
Manually inspect the template for:
- ABOUTME comments present
- faviconURL and timeAgo template calls use correct syntax
- rel="noopener noreferrer" present on external link
- Empty state handled with {{else}}
  </verify>
  <done>
Article cards display favicon, clickable title, blog name, and relative time.
External links have proper security attributes.
Template uses faviconURL and timeAgo template functions.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add article card CSS styles</name>
  <files>static/styles.css</files>
  <action>
Add article card styles to static/styles.css. Find the existing "Article List Styling" section (around line 204) and REPLACE the existing .article styles with the new article-card styles:

Replace this section:
```css
/* ============================================
   Article List Styling
   ============================================ */
.article {
  ...existing styles...
}
```

With:
```css
/* ============================================
   Article Card Styling
   ============================================ */
.article-card {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 1rem;
  margin-bottom: 0.5rem;
  background-color: var(--bg-surface);
  border-radius: 8px;
  border: 1px solid var(--border);
  transition: background-color var(--transition-speed) ease;
}

.article-card:hover {
  background-color: var(--bg-elevated);
}

.article-favicon {
  flex-shrink: 0;
  width: 32px;
  height: 32px;
  border-radius: 4px;
  background-color: var(--bg-elevated);
}

.article-content {
  flex: 1;
  min-width: 0;  /* Enables text truncation */
}

.article-title {
  display: block;
  font-size: 1rem;
  font-weight: 500;
  color: var(--text-primary);
  text-decoration: none;
  margin-bottom: 0.25rem;
  /* Truncate long titles */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.article-title:hover {
  color: var(--accent);
}

.article-meta {
  display: flex;
  gap: 0.5rem;
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.article-source {
  font-weight: 500;
}

.article-time::before {
  content: "Â·";
  margin-right: 0.5rem;
}
```

Keep all other sections in styles.css unchanged. The new styles use existing CSS variables (--bg-surface, --bg-elevated, --text-primary, etc.) established in Phase 2.
  </action>
  <verify>
Run server with `go run main.go` and visually inspect article cards at http://localhost:8080
Check that cards show favicon, title, blog name, and relative time.
Verify hover state changes background color.
  </verify>
  <done>
Article cards display with flexbox layout (favicon left, content right).
Hover state changes background to elevated color.
Title truncates with ellipsis if too long.
Meta section shows blog name and time with separator dot.
  </done>
</task>

</tasks>

<verification>
1. `go build ./...` succeeds with no errors
2. `go run main.go` starts server without errors
3. Visit http://localhost:8080 - article cards display with:
   - Favicon image on left (or hidden if load fails)
   - Article title (clickable, opens in new tab)
   - Blog name below title
   - Relative time ("7 hours ago") if publish date exists
4. Click article title - opens original URL in new browser tab
5. Inspect element - anchor has rel="noopener noreferrer"
6. Switch between Inbox/Archived - articles filter correctly
7. Click blog in sidebar - articles filter to that blog
</verification>

<success_criteria>
- User sees article cards displaying title, source blog name, and relative time
- Each article card shows either a favicon image or gracefully hides broken image
- User can click article card title and original blog post opens in new browser tab
- All external article links have rel="noopener noreferrer" security attribute
- Articles appear in correct filtered view (unread in Inbox, read in Archived)
- Clicking a blog in sidebar filters articles to only show that blog's content
</success_criteria>

<output>
After completion, create `.planning/phases/03-article-display/03-02-SUMMARY.md`
</output>
