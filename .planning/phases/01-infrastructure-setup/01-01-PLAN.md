---
phase: 01-infrastructure-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - go.mod
  - go.sum
  - internal/model/model.go
  - internal/storage/database.go
  - static/htmx.min.js
autonomous: true

must_haves:
  truths:
    - "Database connection opens successfully to ~/.blogwatcher/blogwatcher.db"
    - "Blog and Article models match existing CLI database schema"
    - "ListBlogs and ListArticles queries return data from existing database"
    - "HTMX JavaScript file is available at /static/htmx.min.js"
  artifacts:
    - path: "go.mod"
      provides: "Go module definition"
      contains: "modernc.org/sqlite"
    - path: "internal/model/model.go"
      provides: "Blog and Article structs"
      min_lines: 15
    - path: "internal/storage/database.go"
      provides: "Database connection and query methods"
      exports: ["Database", "OpenDatabase", "ListBlogs", "ListArticles"]
    - path: "static/htmx.min.js"
      provides: "HTMX library for dynamic updates"
  key_links:
    - from: "internal/storage/database.go"
      to: "~/.blogwatcher/blogwatcher.db"
      via: "sql.Open with modernc.org/sqlite driver"
      pattern: "sql\\.Open.*sqlite"
---

<objective>
Set up Go module, database layer, and HTMX static file for BlogWatcher UI.

Purpose: Establish the foundation for connecting to the existing blogwatcher database and serving HTMX-powered dynamic content. This plan creates the data layer that Plan 02's server will use.

Output: Working database connection that can read existing blogs/articles from ~/.blogwatcher/blogwatcher.db, plus HTMX library ready to serve.
</objective>

<execution_context>
@/Users/esteban.torres/.claude/get-shit-done/workflows/execute-plan.md
@/Users/esteban.torres/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-infrastructure-setup/01-RESEARCH.md
@.reference/blogwatcher/internal/model/model.go
@.reference/blogwatcher/internal/storage/database.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Go module and add dependencies</name>
  <files>go.mod, go.sum</files>
  <action>
    Initialize Go module with:
    ```bash
    go mod init github.com/esttorhe/blogwatcher-ui
    go get modernc.org/sqlite@latest
    ```

    The module name matches the repository path. Only dependency needed for this plan is modernc.org/sqlite (pure-Go SQLite driver, same as reference CLI).
  </action>
  <verify>
    Run `go mod tidy` - should complete without errors.
    Run `cat go.mod` - should show module name and sqlite dependency.
  </verify>
  <done>go.mod exists with module github.com/esttorhe/blogwatcher-ui and modernc.org/sqlite dependency</done>
</task>

<task type="auto">
  <name>Task 2: Create model and storage packages</name>
  <files>internal/model/model.go, internal/storage/database.go</files>
  <action>
    Create model package (internal/model/model.go):
    - Add ABOUTME comment at top
    - Copy Blog and Article structs from reference (.reference/blogwatcher/internal/model/model.go)
    - Keep identical field names and types to match existing database schema

    Create storage package (internal/storage/database.go):
    - Add ABOUTME comment at top
    - Adapt from reference (.reference/blogwatcher/internal/storage/database.go)
    - Key changes from reference:
      1. Do NOT create tables (init method should only verify connection, not create schema)
      2. Return error if database file doesn't exist (friendly message: "Database not found at %s - run blogwatcher CLI to initialize")
      3. Add SetMaxOpenConns(1) for SQLite single-writer constraint
      4. Keep ListBlogs() and ListArticles() methods for reading data
      5. Keep MarkArticleRead/MarkArticleUnread for later phases
    - Import path: github.com/esttorhe/blogwatcher-ui/internal/model

    Do NOT copy methods for AddBlog, AddArticle, RemoveBlog - we only read from existing database (blog management via CLI only per PROJECT.md).
  </action>
  <verify>
    Run `go build ./internal/...` - should compile without errors.
    Run `go vet ./internal/...` - should pass.
  </verify>
  <done>
    - internal/model/model.go defines Blog and Article structs matching database schema
    - internal/storage/database.go provides OpenDatabase, ListBlogs, ListArticles, Close methods
    - Code compiles and passes vet
  </done>
</task>

<task type="auto">
  <name>Task 3: Download HTMX and verify database connection</name>
  <files>static/htmx.min.js</files>
  <action>
    Create static directory and download HTMX:
    ```bash
    mkdir -p static
    curl -o static/htmx.min.js https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js
    ```

    HTMX 2.0.8 is self-hosted (not CDN) per research recommendations for production reliability.

    Create a simple test to verify database connection works with existing blogwatcher.db:
    - Create cmd/verify-db/main.go (temporary test program)
    - Opens database at default path
    - Lists blogs and articles count
    - Prints success message

    Run the verification to confirm connection works.
  </action>
  <verify>
    Run `ls -la static/htmx.min.js` - file should exist (approximately 50KB).
    Run `go run ./cmd/verify-db` - should print blog/article counts or friendly "database not found" message.
    If database exists: Should show count of blogs and articles.
    If database doesn't exist: Should show clear message about running CLI first.
  </verify>
  <done>
    - static/htmx.min.js contains HTMX 2.0.8 library
    - Database connection verified working with existing blogwatcher.db
    - Friendly error message shown when database doesn't exist
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Module setup: `go mod tidy` succeeds, go.mod shows sqlite dependency
2. Code quality: `go build ./...` and `go vet ./...` pass
3. Database layer: `go run ./cmd/verify-db` connects and queries existing database
4. HTMX ready: `ls static/htmx.min.js` shows file exists
5. No schema modification: Database file unchanged (we only read, never write schema)
</verification>

<success_criteria>
- Go module initialized with modernc.org/sqlite dependency
- Model structs (Blog, Article) match existing database schema exactly
- Storage layer opens database at ~/.blogwatcher/blogwatcher.db
- Storage layer returns friendly error when database missing (not panic)
- ListBlogs() and ListArticles() return data from existing database
- HTMX 2.0.8 minified JS ready to serve
- All code compiles and passes go vet
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure-setup/01-01-SUMMARY.md`
</output>
