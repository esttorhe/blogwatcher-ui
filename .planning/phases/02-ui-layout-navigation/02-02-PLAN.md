---
phase: 02-ui-layout-navigation
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - templates/partials/sidebar.gohtml
  - templates/partials/blog-list.gohtml
  - templates/partials/article-list.gohtml
  - internal/server/handlers.go
autonomous: true

must_haves:
  truths:
    - "Clicking Inbox in sidebar shows unread articles in main content"
    - "Clicking Archived in sidebar shows read articles in main content"
    - "Clicking a blog in sidebar filters articles to only that blog"
    - "URL updates when navigating (browser back/forward works)"
    - "Active navigation item is visually highlighted"
    - "Mobile sidebar closes after navigation"
  artifacts:
    - path: "templates/partials/sidebar.gohtml"
      provides: "HTMX navigation links with hx-get, hx-target, hx-push-url"
      contains: "hx-get"
    - path: "templates/partials/blog-list.gohtml"
      provides: "Blog links with HTMX click handlers"
      contains: "hx-target"
    - path: "internal/server/handlers.go"
      provides: "Updated handleArticleList with filter and blog query params"
      contains: "r.URL.Query().Get"
  key_links:
    - from: "templates/partials/sidebar.gohtml"
      to: "internal/server/handlers.go"
      via: "hx-get to /articles endpoint"
      pattern: 'hx-get="/articles'
    - from: "templates/partials/blog-list.gohtml"
      to: "internal/server/handlers.go"
      via: "hx-get with blog param"
      pattern: 'hx-get="/articles\?blog='
    - from: "internal/server/handlers.go"
      to: "internal/storage/database.go"
      via: "ListArticles with filter params"
      pattern: "ListArticles.*unreadOnly.*blogID"
---

<objective>
Wire sidebar navigation to main content area using HTMX, enabling filter views (Inbox/Archived) and blog filtering.

Purpose: Makes the sidebar functional - users can now navigate between views and filter articles without full page reloads. This is the core navigation interaction for the app.

Output: Working HTMX navigation that updates main content, supports filter/blog query params, shows active states, and auto-closes mobile sidebar.
</objective>

<execution_context>
@/Users/esteban.torres/.claude/get-shit-done/workflows/execute-plan.md
@/Users/esteban.torres/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-ui-layout-navigation/02-RESEARCH.md
@.planning/phases/02-ui-layout-navigation/02-01-SUMMARY.md

Existing files to update:
@internal/server/handlers.go
@internal/storage/database.go (reference only - already has ListArticles with params)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update handlers to support filter and blog query parameters</name>
  <files>internal/server/handlers.go</files>
  <action>
Update internal/server/handlers.go handleArticleList function:

1. Parse query parameters:
   - filter := r.URL.Query().Get("filter") // "unread" or "read"
   - blogParam := r.URL.Query().Get("blog") // blog ID as string

2. Convert filter to unreadOnly bool:
   - "read" filter means unreadOnly = false, but only show is_read = true articles
   - "unread" or empty filter means unreadOnly = true (show is_read = false)
   - Note: The current ListArticles(unreadOnly bool, blogID *int64) uses unreadOnly to filter WHERE is_read = 0
   - For "read" filter, we need to show WHERE is_read = 1 - this requires updating the logic

3. For the "read" filter case, we need a new approach since ListArticles only supports unreadOnly.
   Option: Add a new function or modify ListArticles to accept a filter enum.
   Simplest: Create a new ListReadArticles method or modify ListArticles signature.

   RECOMMENDED: Modify the Database.ListArticles to accept a filter string instead:
   - ListArticles(filter string, blogID *int64)
   - filter "unread" -> WHERE is_read = 0
   - filter "read" -> WHERE is_read = 1
   - filter "" (empty) -> no is_read filter (show all)

   BUT: Don't modify database.go in this plan (different file ownership).
   INSTEAD: For now, use unreadOnly=false to get ALL articles, then we can filter in handler if needed.

   ACTUAL APPROACH: Looking at database.go, ListArticles(unreadOnly bool, blogID *int64):
   - unreadOnly=true -> WHERE is_read = 0 (unread only)
   - unreadOnly=false -> no filter (shows ALL articles)

   For Phase 2, we need:
   - Inbox (unread): unreadOnly=true
   - Archived (read): Need a different query

   Create a new database method in this plan since it's directly needed by the handler.
   Add to database.go: ListArticlesByReadStatus(isRead bool, blogID *int64) []Article

4. Parse blogID from blogParam string to *int64 (use strconv.ParseInt)

5. Add CurrentFilter and CurrentBlogID to template data for active state highlighting:
   data["CurrentFilter"] = filter
   data["CurrentBlogID"] = blogID (nil if not filtering by blog)

6. Update handleIndex to also support query params so direct URL access works
  </action>
  <verify>curl -s "http://localhost:8080/articles?filter=unread" returns unread articles</verify>
  <done>Handlers parse filter and blog query params, pass CurrentFilter to templates</done>
</task>

<task type="auto">
  <name>Task 2: Add ListArticlesByReadStatus to database layer</name>
  <files>internal/storage/database.go</files>
  <action>
Add new method to internal/storage/database.go:

// ListArticlesByReadStatus returns articles filtered by read status
// isRead=true returns read articles, isRead=false returns unread articles
// blogID filters to specific blog if provided
func (db *Database) ListArticlesByReadStatus(isRead bool, blogID *int64) ([]model.Article, error) {
    query := `SELECT id, blog_id, title, url, published_date, discovered_date, is_read FROM articles WHERE is_read = ?`
    args := []interface{}{isRead}

    if blogID != nil {
        query += " AND blog_id = ?"
        args = append(args, *blogID)
    }
    query += " ORDER BY discovered_date DESC"

    rows, err := db.conn.Query(query, args...)
    // ... rest follows existing ListArticles pattern
}

This gives handlers clean control over read status filtering:
- Inbox: ListArticlesByReadStatus(false, blogID) -> unread
- Archived: ListArticlesByReadStatus(true, blogID) -> read
  </action>
  <verify>Method compiles and can be called from handlers</verify>
  <done>Database has ListArticlesByReadStatus method for explicit read status filtering</done>
</task>

<task type="auto">
  <name>Task 3: Add HTMX attributes to sidebar and blog list templates</name>
  <files>templates/partials/sidebar.gohtml, templates/partials/blog-list.gohtml</files>
  <action>
Update templates/partials/sidebar.gohtml navigation links:

1. Update Inbox link:
   &lt;a href="/articles?filter=unread"
      hx-get="/articles?filter=unread"
      hx-target="#main-content"
      hx-push-url="true"
      hx-on:htmx:after-swap="document.getElementById('sidebar-toggle').checked = false"
      class="nav-link {{if eq .CurrentFilter "unread"}}active{{end}}"&gt;
     Inbox
   &lt;/a&gt;

2. Update Archived link:
   &lt;a href="/articles?filter=read"
      hx-get="/articles?filter=read"
      hx-target="#main-content"
      hx-push-url="true"
      hx-on:htmx:after-swap="document.getElementById('sidebar-toggle').checked = false"
      class="nav-link {{if eq .CurrentFilter "read"}}active{{end}}"&gt;
     Archived
   &lt;/a&gt;

3. The hx-on:htmx:after-swap closes mobile sidebar after navigation (fixes pitfall from RESEARCH.md)

Update templates/partials/blog-list.gohtml:

1. Change blog divs to anchor links with HTMX:
   {{range .Blogs}}
   &lt;a href="/articles?blog={{.ID}}"
      hx-get="/articles?blog={{.ID}}"
      hx-target="#main-content"
      hx-push-url="true"
      hx-on:htmx:after-swap="document.getElementById('sidebar-toggle').checked = false"
      class="blog-item {{if eq $.CurrentBlogID .ID}}active{{end}}"&gt;
     {{.Name}}
   &lt;/a&gt;
   {{else}}
   &lt;p class="empty-state"&gt;No blogs tracked yet. Use the blogwatcher CLI to add blogs.&lt;/p&gt;
   {{end}}

Note: Use $.CurrentBlogID to access root context from inside range loop
  </action>
  <verify>Navigation links have hx-get, hx-target, and hx-push-url attributes</verify>
  <done>Sidebar nav and blog list use HTMX for dynamic content loading</done>
</task>

</tasks>

<verification>
1. Start server: go run cmd/server/main.go
2. Visit http://localhost:8080
3. Click "Inbox" in sidebar - main content updates, URL changes to ?filter=unread
4. Click "Archived" in sidebar - main content updates, URL changes to ?filter=read
5. Click a blog name in sidebar - articles filter to that blog, URL changes
6. Click browser back button - previous view restores
7. Directly visit http://localhost:8080/articles?filter=read - shows archived articles
8. On mobile: click hamburger, click nav item - sidebar closes automatically
9. Verify active states: current nav item has visual highlight
</verification>

<success_criteria>
- Clicking Inbox shows only unread articles (is_read = false)
- Clicking Archived shows only read articles (is_read = true)
- Clicking a blog filters articles to that blog only
- URL updates on navigation (hx-push-url working)
- Browser back/forward navigation works
- Active nav item is visually highlighted
- Mobile sidebar closes after clicking a nav item
- Direct URL access works (?filter=read loads correctly)
</success_criteria>

<output>
After completion, create `.planning/phases/02-ui-layout-navigation/02-02-SUMMARY.md`
</output>
